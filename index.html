<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="https://i.imgur.com/RdENATy.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pump Chump</title>
    <!-- CRITICAL: Load all polyfills synchronously BEFORE React -->
    <script>
      // Global and process polyfills
      window.global = window.global || window;
      window.process = {
        env: { NODE_ENV: 'production' },
        version: 'v18.0.0',
        versions: { node: '18.0.0' },
        browser: true,
        nextTick: function(fn) { setTimeout(fn, 0); }
      };
    </script>
    
    <!-- Load Buffer library synchronously -->
    <script src="https://unpkg.com/buffer@6.0.3/index.js"></script>
    
    <!-- Immediately setup Buffer after library loads -->
    <script>
      // Set up Buffer immediately - no waiting
      if (typeof buffer !== 'undefined' && buffer.Buffer) {
        window.Buffer = buffer.Buffer;
        console.log('‚úÖ Buffer polyfill success:', typeof window.Buffer.alloc);
      } else {
        console.error('‚ùå Buffer library not found, creating fallback');
        window.Buffer = {
          alloc: function(size, fill, encoding) {
            const buf = new Uint8Array(size);
            if (fill !== undefined) {
              if (typeof fill === 'number') buf.fill(fill);
              else if (typeof fill === 'string') {
                const bytes = new TextEncoder().encode(fill);
                for (let i = 0; i < size; i++) buf[i] = bytes[i % bytes.length];
              }
            }
            return buf;
          },
          from: function(data, encoding) {
            if (typeof data === 'string') return new TextEncoder().encode(data);
            if (data instanceof ArrayBuffer) return new Uint8Array(data);
            return new Uint8Array(data);
          },
          isBuffer: function(obj) { return obj instanceof Uint8Array; },
          concat: function(list) {
            let totalLength = 0;
            for (const buf of list) totalLength += buf.length;
            const result = new Uint8Array(totalLength);
            let offset = 0;
            for (const buf of list) {
              result.set(buf, offset);
              offset += buf.length;
            }
            return result;
          }
        };
      }
      
      // Require polyfill
      window.require = window.require || function(module) {
        if (module === 'crypto') return window.crypto;
        if (module === 'buffer') return { Buffer: window.Buffer };
        if (module === 'process') return window.process;
        return {};
      };
      
      // Verify everything is ready
      console.log('üîß Polyfill verification:', {
        'Buffer': typeof window.Buffer,
        'Buffer.alloc': typeof window.Buffer?.alloc,
        'Process': typeof window.process,
        'Global': typeof window.global,
        'Ready': !!(window.Buffer && window.Buffer.alloc && window.process && window.global)
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>